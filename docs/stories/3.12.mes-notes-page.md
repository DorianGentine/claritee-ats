# Story 3.12: Page Mes notes

## Status

Draft

## Story

**As a** recruiter,  
**I want** a dedicated "Mes notes" page to view, organize, edit and classify my free-standing notes,  
**so that** I can manage my quick notes before moving them to candidates or offers.

## Acceptance Criteria

1. Page "Mes notes" accessible depuis la navbar et depuis le widget de notes (lien "Mes notes")
2. Liste des notes libres (sans candidat/offre) triées par dernière modification
3. Affichage : titre (ou 30 premiers caractères si absent), extrait du contenu, date de modification
4. Clic sur une note ouvre l'édition (inline ou panneau détail)
5. Édition : titre, contenu BlockNote ; sauvegarde explicite ou auto-save
6. Suppression avec confirmation
7. Possibilité de "déplacer" une note vers un candidat ou une offre (association candidateId/offerId) — permet de rebasculer les prises de notes
8. Empty state : "Aucune note"
9. Lien rapide pour ouvrir le widget depuis la page

## Tasks / Subtasks

- [ ] Task 1: Route et page
  - [ ] Créer `src/app/(dashboard)/notes/page.tsx`. [Source: docs/architecture/source-tree.md]
  - [ ] Page protégée (layout dashboard). [Source: docs/frontend-architecture.md §2]
- [ ] Task 2: API – listFree et déplacement
  - [ ] `note.listFree` (déjà prévu en 3.11) : notes sans candidateId ni offerId. [Source: Story 3.11]
  - [ ] `note.moveToCandidate` : input `{ id, candidateId }` ; met à jour candidateId ; vérifier auteur et companyId. [Source: prisma/schema.prisma]
  - [ ] `note.moveToOffer` : input `{ id, offerId }` ; met à jour offerId. [Source: idem]
  - [ ] Notes déplacées ne s'affichent plus dans "Mes notes" (listFree les exclut). [Source: logique métier]
- [ ] Task 3: Liste des notes
  - [ ] Afficher les notes via `note.listFree` ; carte ou ligne par note : titre (ou 30 premiers chars), extrait, date. [Source: wireframes à adapter]
  - [ ] Clic ouvre panneau détail ou mode édition inline. [Source: AC 4]
- [ ] Task 4: Édition
  - [ ] Panneau ou modal avec champ titre + BlockNote ; bouton Enregistrer ou auto-save. [Source: AC 5]
  - [ ] Suppression : ConfirmDialog. [Source: AC 6]
- [ ] Task 5: Déplacer vers candidat/offre
  - [ ] Bouton "Déplacer vers..." ou "Associer à" ; dropdown Candidat (candidate.list) et/ou Offre (offer.list si dispo). [Source: AC 7]
  - [ ] Mutations moveToCandidate, moveToOffer ; invalidation listFree. [Source: Task 2]
- [ ] Task 6: Navigation
  - [ ] Ajouter "Mes notes" dans la navbar (SiteNavbar). [Source: AC 1]
  - [ ] Le widget (Story 3.11) a déjà un lien vers /notes. [Source: Story 3.11]
  - [ ] Bouton pour ouvrir le widget depuis la page. [Source: AC 9]
- [ ] Task 7 – Testing
  - [ ] Tests d'intégration : listFree, moveToCandidate, moveToOffer, update, delete. [Source: docs/architecture.md §14]
  - [ ] Test manuel : liste, édition, déplacement, suppression.
- [ ] Task 8 (QA): Rédiger les cas de test dans docs/stories/cases/3.12-test-cases.md.
- [ ] Task 9 (review): Lancer une review de code en fin de développement avant clôture.

## Dev Notes

### Dependencies

- Story 3.11 doit être implémentée (widget, notes libres, champ titre, note.listFree).

### Data Models

- **Note** : id, title, content, authorId, candidateId (nullable), offerId (nullable), companyId. [Source: prisma/schema.prisma]

### API Specifications

- **note.listFree** : notes où candidateId IS NULL AND offerId IS NULL. [Source: Story 3.11]
- **note.moveToCandidate** : update candidateId ; note.moveToOffer : update offerId.

### File Locations

| Purpose | Path |
|---------|------|
| Page | src/app/(dashboard)/notes/page.tsx |
| Router note | src/server/trpc/routers/note.ts |
| Navbar | src/components/layout/SiteNavbar.tsx |

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-21 | 0.1 | Story draft created (3.12 Mes notes) | Bob (SM) |

---

## Dev Agent Record

*(To be filled by Dev Agent)*

---

## QA Results

*(To be filled by QA Agent)*
