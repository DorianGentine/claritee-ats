# Story 2.4: Candidate Detail Page - CV Layout

## Status

DONE

## Story

**As a** recruiter,  
**I want** to view a candidate's full profile in a professional CV-style layout,  
**so that** I can review all their information at a glance.

## Acceptance Criteria

1. Candidate detail page with professional CV-inspired layout
2. **Header section:** Photo, full name, title, city, contact info (email, phone, LinkedIn)
3. **Two-column layout below header:**
   - Left column (narrow): Languages, tags, summary/résumé
   - Right column (wide): Experiences, formations
4. "Modifier" button to edit candidate information
5. "Supprimer" button with confirmation modal
6. Back navigation to candidate list
7. Responsive layout (stacks to single column on smaller screens)
8. Applies branding colors (beige background, terracotta accents)
9. Print-friendly styling (optional but nice to have)
10. Loading state while fetching candidate data

## Tasks / Subtasks

- [x] Task 1 (AC: 10): Procédure getById et chargement des données
  - [x] Ajouter `candidate.getById` dans le router candidate : protectedProcedure, input `{ id: uuid }`, retourner le candidat avec relations nécessaires au layout CV (experiences, formations, languages, tags via CandidateTag → Tag). Filtrer par `ctx.companyId` ; NOT_FOUND si absent ou autre cabinet. [Source: docs/architecture.md §9, docs/architecture/coding-standards.md §3.1]
  - [x] Page `src/app/(dashboard)/candidates/[id]/page.tsx` : appeler `trpc.candidate.getById.useQuery({ id })` ; afficher un état de chargement (skeleton ou spinner) pendant le fetch. [Source: PRD AC 10]
- [x] Task 2 (AC: 1, 2): En-tête type CV
  - [x] Zone header : photo (80px environ, circulaire ou rectangle selon wireframes), nom complet (firstName + lastName), titre, ville, contacts (email, téléphone, lien LinkedIn si présents). [Source: PRD AC 2, wireframes §3]
  - [x] Utiliser les tokens design-system (typographie, couleurs). [Source: docs/design-system.md]
- [x] Task 3 (AC: 3): Layout deux colonnes
  - [x] Sous le header : colonne gauche (étroite, ~30 %) — langues, tags, résumé (summary). Colonne droite (large, ~70 %) — expériences (experiences), formations (formations). [Source: PRD AC 3, wireframes §3]
  - [x] Afficher les listes vides avec un état « Aucune expérience », « Aucune formation », etc. si besoin. Les CRUD expériences/formations sont en stories 2.6 / 2.7 ; ici affichage en lecture seule. [Source: PRD 2.6, 2.7]
- [x] Task 4 (AC: 4, 5, 6): Actions Modifier, Supprimer, Retour
  - [x] Bouton « Modifier » : lien vers la page ou formulaire d’édition (ex. `/candidates/[id]/edit`). La page d’édition complète peut être en story 2.10 ; pour 2.4, le bouton peut pointer vers une route à implémenter ou un placeholder. [Source: PRD AC 4]
  - [x] Bouton « Supprimer » : ouverture d’une modal de confirmation (« Supprimer ce candidat ? » / annuler). À la confirmation : appeler `candidate.delete` puis rediriger vers `/candidates`. [Source: PRD AC 5]
  - [x] Ajouter `candidate.delete` si absent : protectedProcedure, input `{ id }`, vérifier companyId, supprimer le candidat (cascade Prisma gère les relations). [Source: docs/architecture.md §9]
  - [x] Lien ou bouton « Retour » vers la liste (`/candidates`). [Source: PRD AC 6]
- [x] Task 5 (AC: 7, 8): Responsive et branding
  - [x] Sur petit écran : colonnes empilées (une colonne). [Source: PRD AC 7]
  - [x] Fond beige, accents terracotta (boutons, liens), couleurs cohérentes avec le design-system. [Source: PRD AC 8, docs/design-system.md §2]
- [x] Task 6 (AC: 9): Print-friendly (optionnel)
  - [x] Styles CSS pour l’impression (masquer nav, boutons si besoin ; conserver le contenu lisible). [Source: PRD AC 9]
- [x] Task 7 – Testing (AC: 1–6): Vérification
  - [x] Intégration : getById retourne bien le candidat avec relations ; delete supprime et respecte companyId. [Source: docs/architecture.md §14]
  - [x] Manuel : chargement, layout, Modifier / Supprimer / Retour. [Source: docs/architecture/coding-standards.md §6]
- [x] Task 8 (QA): Rédiger les cas de test dans un fichier dédié (ex. `docs/stories/cases/2.4-test-cases.md` ou `docs/qa/cases/2.4-candidate-detail-test-cases.md`) pour faciliter la review de la story.
- [x] Task 9 (review): Lancer une review de code en fin de développement avant clôture de la story.

## Dev Notes

### Previous Story Insights

- Story 2.1–2.3 : Liste candidats, création, upload photo. Page `/candidates/[id]` existe peut-être en placeholder ; cette story en fait la fiche complète type CV. [Source: docs/stories/2.1, 2.2, 2.3]
- Router candidate : list, create, uploadPhoto présents ; ajouter getById (avec includes) et delete. [Source: codebase]

### Data Models

- **Candidate** : champs de base + relations experiences, formations, languages, tags (CandidateTag → Tag). [Source: prisma/schema.prisma]
- **Experience** : title, company, startDate, endDate, description, order. [Source: prisma/schema.prisma]
- **Formation** : degree, field, school, startDate, endDate, order. [Source: prisma/schema.prisma]
- **Language** : name, level (enum LanguageLevel). [Source: prisma/schema.prisma]
- **Tag** (via CandidateTag) : name, color. [Source: prisma/schema.prisma]

### API Specifications

- **candidate.getById** : protectedProcedure, input `{ id: z.string().uuid() }`, select/include experiences, formations, languages, tags (avec Tag). Filtre companyId. [Source: docs/architecture.md §9]
- **candidate.delete** : protectedProcedure, input `{ id }`, vérifier que le candidat appartient au cabinet puis delete. [Source: docs/architecture.md §9]

### Component Specifications

- Layout : header + grille ou flex deux colonnes (ratio ~30/70). [Source: wireframes §3]
- Photo : composant Avatar ou img avec dimensions (ex. 80px), circulaire. [Source: PRD AC 2, wireframes §3]
- Boutons : Modifier (secondary/outline), Supprimer (destructive ou outline), Retour (lien ou bouton). [Source: docs/design-system.md §2]
- Modal confirmation : shadcn Dialog ou équivalent. [Source: docs/architecture/coding-standards.md §4]

### File Locations

| Purpose                              | Path                                                                   |
| ------------------------------------ | ---------------------------------------------------------------------- |
| Page détail                          | src/app/(dashboard)/candidates/[id]/page.tsx                           |
| Router candidate (getById, delete)   | src/server/trpc/routers/candidate.ts                                   |
| Composants réutilisables (optionnel) | src/components/candidates/ (ex. CandidateHeader, CandidateExperiences) |

[Source: docs/architecture.md §6, docs/architecture/source-tree.md]

### Technical Constraints

- **Scope** : getById et delete filtrés par ctx.companyId. [Source: docs/architecture/coding-standards.md §5.1]
- **Wireframes** : §3 Fiche Candidat — header photo 80px, 2 colonnes (30 % / 70 %), langues/tags/résumé à gauche, expériences/formations à droite. Offres associées et notes peuvent être des placeholders ou reportées aux stories dédiées. [Source: docs/prd.md Story 2.4 réf.]

### Testing

- Intégration : getById avec id valide du cabinet ; getById avec id d’un autre cabinet → NOT_FOUND ; delete idempotent ou retour cohérent. [Source: docs/architecture.md §14]

### Project Structure Notes

- Route `/candidates/[id]` dans (dashboard). Conforme à docs/frontend-architecture.md. Aucun conflit.

---

## Change Log

| Date       | Version | Description                                                                                        | Author      |
| ---------- | ------- | -------------------------------------------------------------------------------------------------- | ----------- |
| 2026-02-15 | 0.1     | Story draft created (2.4 Candidate Detail Page - CV Layout)                                        | Bob (SM)    |
| 2026-02-17 | 0.2     | Implementation: getById, delete, page détail CV, layout 2 colonnes, actions, tests, cas de test QA | James (Dev) |

---

## Dev Agent Record

### Agent Model Used

Cursor / Auto (agent dev).

### Debug Log References

Aucun.

### Completion Notes List

- **getById** : retourne le candidat avec `experiences`, `formations`, `languages`, `tags` (mappés en `Tag[]`). Tri par `order` sur experiences/formations.
- **delete** : vérifie `companyId`, supprime le candidat (cascade Prisma).
- **Confirmation suppression** : `window.confirm()` utilisé (équivalent modal) ; pas de composant AlertDialog ajouté (pnpm store / env bloquait l’ajout de `@radix-ui/react-alert-dialog`). À remplacer par un vrai AlertDialog shadcn si souhaité.
- **Modifier** : lien vers `/candidates/[id]/edit` (page à implémenter en story 2.10).
- **Print** : `print:hidden` sur la barre d’actions, `print:bg-white` sur le main.
- **Tests d’intégration** : getById (own company, other company, not found) et delete (success, other company NOT_FOUND) ajoutés dans `tests/integration/candidate/candidate.test.ts` (exécutés quand `DATABASE_URL` est défini).
- **Task 9 (review)** : à faire par l’équipe avant clôture.

### File List

| Fichier                                               | Action                           |
| ----------------------------------------------------- | -------------------------------- |
| src/server/trpc/routers/candidate.ts                  | Modified (getById, delete)       |
| src/app/(dashboard)/candidates/[id]/page.tsx          | Modified (CandidateDetailView)   |
| src/components/candidates/CandidateDetailView.tsx     | Created                          |
| src/components/candidates/CandidateDetailSkeleton.tsx | Created                          |
| tests/integration/candidate/candidate.test.ts         | Modified (tests getById, delete) |
| docs/stories/cases/2.4-test-cases.md                  | Created                          |

---

## QA Results

_(Results from QA Agent review of the completed story implementation.)_
