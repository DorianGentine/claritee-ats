# Story 1.6: Dashboard Home Page

## Status

Ready for Review

## Story

**As a** logged-in user,  
**I want** to see a Dashboard with key metrics and quick actions,  
**so that** I have an overview of my cabinet's activity.

## Acceptance Criteria

1. Dashboard is the default page after login
2. Displays company name in header/navigation
3. Shows placeholder cards for future metrics: "Candidats", "Offres actives", "Clients"
4. Cards show "0" count initially (empty state)
5. Quick action buttons: "Nouveau candidat", "Nouvelle offre" (disabled/coming soon for now)
6. Navigation sidebar/header with links: Dashboard, Candidats, Offres, Clients (Candidats/Offres/Clients disabled for now)
7. User menu with: profile info, logout button
8. Responsive layout (desktop-first, basic tablet support)
9. Applies the branding color palette (beige background, terracotta accents, sage green secondary)
10. Empty state message encouraging user to start adding data

## Tasks / Subtasks

- [x] Task 1 (AC: 2, 6, 7): Données company et extension de la navbar existante
  - [x] Add router `company` with `getMyCompany`: protectedProcedure, returns `{ id, name }` for ctx.companyId. Register in _app.ts. [Source: docs/architecture.md §9]
  - [x] **Préserver la navbar existante** (`SiteNavbar` dans le layout root) : ne pas la remplacer ni créer une seconde barre. **Étendre** ce composant (ou le layout dashboard) pour les pages authentifiées : afficher le nom du cabinet (via `company.getMyCompany`), les liens de navigation, et le menu utilisateur. [Source: docs/frontend-architecture.md §4.3, PRD AC 2, 6, 7 ; correct-course 2026-02 : préserver travail des stories 1.4/1.5]
  - [x] Nav links: Dashboard (active on `/dashboard`), Candidats, Offres, Clients. Candidats/Offres/Clients are disabled or point to `#` with "Bientôt" / disabled state for now. [Source: PRD AC 6]
  - [x] User menu: profile info (e.g. user name or email from session), logout button (conserver le comportement existant). [Source: PRD AC 7]
- [x] Task 2 (AC: 1): Default page after login
  - [x] Confirm redirect after login is `/dashboard` (already in place in Story 1.4). No change if already correct. [Source: PRD AC 1]
- [x] Task 3 (AC: 3, 4, 10): Dashboard content — metric cards and empty state
  - [x] On `src/app/(dashboard)/dashboard/page.tsx`: add three cards "Candidats", "Offres actives", "Clients" with count **0** (hardcoded for now; real counts in later stories). [Source: PRD AC 3, 4, docs/design-system.md §2]
  - [x] Use design-system tokens for cards (`--card`, `--foreground`, `--muted-foreground`). [Source: docs/design-system.md §2, §4]
  - [x] Add empty state message encouraging user to start adding data (e.g. "Ajoutez votre premier candidat ou une offre pour commencer."). [Source: PRD AC 10]
- [x] Task 4 (AC: 5): Quick action buttons
  - [x] Add buttons "Nouveau candidat" and "Nouvelle offre" on the dashboard. Disabled or "Bientôt" for now (no navigation to forms yet). [Source: PRD AC 5]
- [x] Task 5 (AC: 8, 9): Responsive layout and branding
  - [x] Layout desktop-first (≥1024px); basic tablet support (layout remains usable). [Source: docs/prd.md Target Device, PRD AC 8]
  - [x] Apply branding: background `--background` (#F5F0E8), primary terracotta for main CTAs, secondary sage for nav/secondary actions; surfaces `--card`. [Source: docs/design-system.md §2, docs/prd.md Branding]
- [x] Task 6 – Testing (AC: 2–7): Verification
  - [x] Manual: login → dashboard shows company name, cards with 0, nav links, user menu, logout works. [Source: docs/architecture.md §14]
  - [x] Optionally: component test for dashboard cards or shell with mocked company data. [Source: docs/architecture/coding-standards.md §6]
- [x] Task 7 (QA): Rédiger les cas de test dans un fichier dédié (ex. `docs/stories/cases/1.6-test-cases.md` ou `docs/qa/cases/1.6-dashboard-test-cases.md`) pour faciliter la review de la story.
- [ ] Task 8 (review): Lancer une review de code en fin de développement avant clôture de la story.

## Dev Notes

### Previous Story Insights

- Story 1.5: Invitation system done; settings/team page exists. Dashboard layout uses `DashboardShell` (minimal: main only). [Source: docs/stories/1.5, codebase]
- Story 1.4: **SiteNavbar** (root layout) fournit déjà : logo Claritee, lien « Mon espace », bouton Déconnexion, états auth. Ne pas remplacer ni dupliquer cette navbar ; l’étendre pour ajouter nom du cabinet, liens nav (Dashboard, Candidats, Offres, Clients), menu user. [Source: docs/stories/1.4, src/components/layout/SiteNavbar.tsx]
- No `company` router yet; architecture §9 specifies company: getMyCompany, updateCompany. [Source: docs/architecture.md §9]

### Data Models

- **Company:** id, name, siren, etc. Only `name` (and id) needed for getMyCompany. [Source: prisma/schema.prisma]

### API Specifications

- **company.getMyCompany:** protectedProcedure, no input, returns `{ id: string, name: string }` for the company of ctx.companyId. [Source: docs/architecture.md §9]

### Component Specifications

- Cards: use shadcn Card or equivalent; design-system variables for background, text, borders. [Source: docs/design-system.md §2, docs/architecture/coding-standards.md §4]
- Navigation: next/link for internal links; active state on Dashboard when pathname is /dashboard. [Source: docs/frontend-architecture.md §7]
- User menu: dropdown or popover with profile info + logout; reuse existing logout logic. [Source: Story 1.4]

### File Locations

| Purpose | Path |
|--------|------|
| Dashboard page | src/app/(dashboard)/dashboard/page.tsx |
| Dashboard layout / shell | src/components/layout/DashboardShell.tsx, src/app/(dashboard)/layout.tsx |
| Company router | src/server/trpc/routers/company.ts |
| Design system tokens | docs/design-system.md ; Tailwind / globals.css (--background, --card, --primary, --secondary) |

[Source: docs/architecture.md §6, docs/architecture/source-tree.md]

### Technical Constraints

- **Styles:** Use CSS variables from design-system (no hardcoded hex for brand colors). [Source: docs/architecture/coding-standards.md §4]
- **Navigation:** Candidats/Offres/Clients disabled or non-clickable for now; no routes to list pages yet (Epic 2/3). [Source: PRD AC 6]
- **Counts:** Cards show 0; no tRPC calls for candidate/offer/client counts in this story. [Source: PRD AC 4]

### Testing

- Manual: full flow login → dashboard content and shell. [Source: docs/architecture.md §14]
- Optional: Vitest + RTL for DashboardShell or dashboard page with mocked trpc. [Source: docs/architecture/coding-standards.md §6]

### Project Structure Notes

- Dashboard is at `/dashboard`; default after login already /dashboard. Wireframes §1 and Design System §2, §4 are the references. No structural conflicts.

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-15 | 0.1 | Story draft created (1.6 Dashboard Home Page) | Bob (SM) |
| 2026-02-15 | 0.2 | Implementation complete: company router, extended navbar, dashboard page | James (Dev) |

---

## Dev Agent Record

### Agent Model Used

Cursor / Auto (Agent)

### Debug Log References

Aucune.

### Completion Notes List

- Router `company` créé avec `getMyCompany` (protectedProcedure).
- `SiteNavbar` étendu : nom du cabinet via tRPC, liens nav (Dashboard actif, Candidats/Offres/Clients désactivés « Bientôt »), email utilisateur + Déconnexion.
- Page dashboard : 3 cartes métriques (0), message d'état vide, boutons « Nouveau candidat » / « Nouvelle offre » désactivés, bouton « Gérer l'équipe » conservé.
- Test d'intégration ajouté pour `company.getMyCompany`.

### File List

| Fichier | Action |
|---------|--------|
| src/server/trpc/routers/company.ts | Created |
| src/server/trpc/routers/_app.ts | Modified |
| src/components/layout/SiteNavbar.tsx | Modified |
| src/app/(dashboard)/dashboard/page.tsx | Modified |
| tests/integration/company/company.test.ts | Created |
| docs/qa/cases/1.6-dashboard-test-cases.md | Created |

---

## QA Results

*(Results from QA Agent review of the completed story implementation.)*
