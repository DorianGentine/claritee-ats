# Story 2.1: Candidate List Page

## Status

DONE

## Story

**As a** recruiter,  
**I want** to see a list of all my cabinet's candidates,  
**so that** I can browse and access candidate profiles.

## Acceptance Criteria

1. Candidates page accessible from main navigation
2. Displays list of candidates as cards or table rows
3. Each candidate shows: photo (or initials placeholder), full name, title, city
4. List sorted by most recently created by default
5. Empty state with illustration and "Ajouter un candidat" CTA
6. "Nouveau candidat" button prominently displayed (terracotta CTA)
7. Click on candidate navigates to candidate detail page
8. List only shows candidates from user's company (RLS enforced)
9. Pagination or infinite scroll for large lists (>20 candidates)
10. Loading skeleton while fetching data

## Tasks / Subtasks

- [x] Task 1 (AC: 8): Router candidate et procédure list
  - [x] Créer `src/server/trpc/routers/candidate.ts` et l’enregistrer dans `_app.ts`. [Source: docs/architecture.md §9, docs/architecture/coding-standards.md §3.1]
  - [x] `list` : protectedProcedure, filtrer par `ctx.companyId`, `orderBy: { createdAt: 'desc' }`. Supporter la pagination (cursor ou offset) avec page size 20. Retourner les champs nécessaires pour la liste : id, firstName, lastName, title, city, photoUrl (et optionnellement tags pour affichage wireframes). [Source: PRD AC 4, 8, 9 ; prisma/schema.prisma]
  - [x] Ne pas exposer de données d’un autre cabinet ; RLS côté DB en plus du filtre applicatif. [Source: docs/architecture/coding-standards.md §5.1]
- [x] Task 2 (AC: 1, 2, 3, 7): Page liste candidats
  - [x] Créer la route `src/app/(dashboard)/candidates/page.tsx`. S’assurer que « Candidats » dans la nav principale pointe vers `/candidates` (activer le lien si désactivé en 1.6/1.7). [Source: docs/frontend-architecture.md §2]
  - [x] Afficher la liste via `trpc.candidate.list.useQuery()` (avec paramètres de pagination si cursor/offset). [Source: docs/frontend-architecture.md §5]
  - [x] Chaque item : photo (ou placeholder initiales si pas de photo), nom complet (firstName + lastName), titre, ville. Optionnel : jusqu’à 3 tags par carte (wireframes §2). [Source: PRD AC 3, docs/prd.md Story 2.1]
  - [x] Clic sur un candidat : navigation vers `/candidates/[id]`. La page détail peut être un placeholder minimal jusqu’à la Story 2.4. [Source: PRD AC 7]
- [x] Task 3 (AC: 5, 6): Empty state et CTA
  - [x] Si la liste est vide : empty state avec message et CTA « Ajouter un candidat » (lien vers la création, à implémenter en 2.2). [Source: PRD AC 5]
  - [x] Bouton « Nouveau candidat » bien visible (primaire terracotta, design-system). [Source: PRD AC 6, docs/design-system.md §2]
- [x] Task 4 (AC: 9): Pagination ou infinite scroll
  - [x] Pour plus de 20 candidats : pagination (boutons page suivante/précédente) ou infinite scroll. Aligner avec `candidate.list` (limit 20 par page). [Source: PRD AC 9, wireframes §2]
- [x] Task 5 (AC: 10): Loading skeleton
  - [x] Afficher un skeleton (cartes ou lignes) pendant le chargement de `candidate.list`. [Source: PRD AC 10]
- [x] Task 6 – Testing (AC: 8, 9): Vérification
  - [x] Intégration : appeler `candidate.list` avec contexte mocké (companyId) et vérifier que seuls les candidats du cabinet sont retournés. [Source: docs/architecture.md §14]
  - [x] Optionnel : test composant liste avec données mockées. [Source: docs/architecture/coding-standards.md §6]
- [x] Task 7 (QA): Rédiger les cas de test dans un fichier dédié (ex. `docs/stories/cases/2.1-test-cases.md` ou `docs/qa/cases/2.1-candidate-list-test-cases.md`) pour faciliter la review de la story.
- [x] Task 8 (review): Lancer une review de code en fin de développement avant clôture de la story.

## Dev Notes

### Previous Story Insights

- Epic 1 terminé : layout, navbar, company, auth, invitation, dashboard. La nav contient déjà un lien Candidats (à activer vers `/candidates` si besoin). [Source: docs/stories/1.6, 1.7]
- Aucun router `candidate` ni page `/candidates` pour l’instant. [Source: codebase]

### Data Models

- **Candidate** : id, firstName, lastName, email, phone, linkedinUrl, title, city, summary, photoUrl, cvUrl, companyId, createdAt, updatedAt. Relations : tags (CandidateTag), experiences, formations, etc. Pour la liste : id, firstName, lastName, title, city, photoUrl (+ tags si besoin). [Source: prisma/schema.prisma]

### API Specifications

- **candidate.list** : protectedProcedure. Input optionnel : cursor ou offset/limit (ex. limit 20, cursor pour page suivante). Output : tableau d’objets { id, firstName, lastName, title, city, photoUrl, tags? } avec nextCursor ou hasMore pour pagination. [Source: docs/architecture.md §9]

### Component Specifications

- Cartes ou lignes : shadcn Card ou table ; design-system (--card, --foreground, --muted-foreground). [Source: docs/design-system.md §2]
- Placeholder photo : initiales (firstName[0] + lastName[0]) si photoUrl absent. [Source: PRD AC 3]
- Bouton primaire terracotta pour « Nouveau candidat ». [Source: PRD AC 6]

### File Locations

| Purpose | Path |
|--------|------|
| Page liste | src/app/(dashboard)/candidates/page.tsx |
| Page détail (placeholder) | src/app/(dashboard)/candidates/[id]/page.tsx (minimal jusqu’à 2.4) |
| Router candidate | src/server/trpc/routers/candidate.ts |
| Validations (si besoin pour list input) | src/lib/validations/candidate.ts |

[Source: docs/architecture.md §6, docs/architecture/source-tree.md]

### Technical Constraints

- **Scope** : Toutes les requêtes candidat filtrées par `ctx.companyId` ; utiliser protectedProcedure. [Source: docs/architecture/coding-standards.md §3]
- **Détail** : Le clic mène vers `/candidates/[id]` ; la fiche complète (layout CV) est en Story 2.4. Pour 2.1, une page placeholder (titre + id ou message « Fiche candidat – bientôt ») suffit. [Source: PRD 2.4]

### Testing

- Intégration : candidate.list avec companyId mocké ; vérifier tri par createdAt desc et pagination. [Source: docs/architecture.md §14]
- Optionnel : test unitaire du schéma Zod si input pagination. [Source: docs/architecture/coding-standards.md §6]

### Project Structure Notes

- Route `/candidates` dans le groupe (dashboard), conforme à docs/frontend-architecture.md. Aucun conflit.

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-15 | 0.1 | Story draft created (2.1 Candidate List Page) | Bob (SM) |
| 2026-02-15 | 0.2 | Implementation: router candidate, page liste, empty state, pagination, skeleton, tests, cas de test QA | James (Dev) |

---

## Dev Agent Record

### Agent Model Used

Cursor / Auto (agent dev James).

### Debug Log References

Aucun.

### Completion Notes List

- Router `candidate` avec `list` en cursor-based pagination (limit 20, nextCursor/hasMore). Tags inclus (jusqu’à 3 par candidat) pour l’affichage liste.
- Page liste : cartes avec Avatar (photo ou initiales), nom, titre, ville, tags ; lien vers `/candidates/[id]`. Lien « Candidats » activé dans la navbar (SiteNavbar).
- Empty state avec CTA « Ajouter un candidat » ; bouton « Nouveau candidat » (variant default = terracotta) en haut à droite. Les deux pointent vers `/candidates/new` (à implémenter en 2.2).
- Pagination : boutons Précédent/Suivant ; `placeholderData: keepPreviousData` pour éviter le flash de chargement.
- Skeleton : 6 cartes en placeholder pendant le chargement.
- Tests d’intégration : `tests/integration/candidate/candidate.test.ts` (list par company, tri createdAt desc, pagination, UNAUTHORIZED). Exécutés en skip sans DATABASE_URL ; à lancer en CI avec base de test.
- Cas de test QA : `docs/stories/cases/2.1-test-cases.md`.

### File List

| Fichier | Action |
|---------|--------|
| src/server/trpc/routers/candidate.ts | Created |
| src/server/trpc/routers/_app.ts | Modified |
| src/lib/validations/candidate.ts | Created |
| src/app/(dashboard)/candidates/page.tsx | Created |
| src/app/(dashboard)/candidates/[id]/page.tsx | Created |
| src/components/layout/SiteNavbar.tsx | Modified |
| tests/integration/candidate/candidate.test.ts | Created |
| docs/stories/cases/2.1-test-cases.md | Created |

---

## QA Results

*(Results from QA Agent review of the completed story implementation.)*
