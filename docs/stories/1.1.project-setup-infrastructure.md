# Story 1.1: Project Setup & Infrastructure

## Status

Done

## Story

**As a** developer,  
**I want** a fully configured Next.js monorepo with Prisma, Supabase, and deployment pipeline,  
**so that** I have a solid foundation to build features upon.

## Acceptance Criteria

1. Next.js 16 App Router project with React 19.2, initialized with TypeScript strict mode
2. Prisma configured with Supabase PostgreSQL connection
3. tRPC configured with Next.js API routes
4. Supabase client SDK configured (auth + storage)
5. Tailwind CSS + shadcn/ui base components installed
6. ESLint + Prettier configured with strict rules
7. Environment variables properly configured (.env.local, .env.example)
8. Project deployable to Vercel with successful build
9. Basic health check route (`/api/health`) returns 200 OK
10. Git repository initialized with proper .gitignore

## Tasks / Subtasks

- [x] Task 1 (AC: 1, 10): Initialize Next.js 16 project with TypeScript strict and Git
  - [x] Create Next.js 16 App Router project (React 19.2, TypeScript). [Source: docs/architecture.md §1.1, docs/architecture/tech-stack.md]
  - [x] Ensure `tsconfig.json` has `strict: true`. [Source: docs/architecture/coding-standards.md §1]
  - [x] Initialize Git repository and add .gitignore (node_modules, .env.local, .vercel, etc.)
- [x] Task 2 (AC: 2): Configure Prisma with Supabase PostgreSQL
  - [x] Install Prisma 7.4.0 and configure `datasource` for PostgreSQL (Supabase connection URL). [Source: docs/architecture/tech-stack.md]
  - [x] Create minimal `prisma/schema.prisma` (schema will be expanded in Story 1.2). [Source: docs/architecture.md §6, docs/architecture/source-tree.md]
- [x] Task 3 (AC: 3): Configure tRPC with Next.js API routes
  - [x] Install tRPC v11 and wire handler at `src/app/api/trpc/[...trpc]/route.ts`. [Source: docs/architecture.md §6, docs/architecture/tech-stack.md]
  - [x] Create `src/server/trpc/trpc.ts`, `context.ts`, and `routers/_app.ts` + `index.ts` (skeleton; full context in Story 1.2). [Source: docs/architecture/source-tree.md, docs/architecture/coding-standards.md §3.1]
- [x] Task 4 (AC: 4): Configure Supabase client SDK
  - [x] Install Supabase JS client and create `src/lib/supabase/client.ts` (browser) and `src/lib/supabase/server.ts` (server/cookies). [Source: docs/architecture.md §6, docs/architecture/source-tree.md]
  - [x] Configure for auth and storage (buckets will be created in later stories). [Source: docs/architecture.md §1.1, §8]
- [x] Task 5 (AC: 5): Install Tailwind CSS and shadcn/ui
  - [x] Install Tailwind CSS 4.1 and configure. [Source: docs/architecture/tech-stack.md]
  - [x] Install shadcn/ui and add base components per project conventions; place in `src/components/ui/`. [Source: docs/architecture/source-tree.md §2, docs/architecture/coding-standards.md §4]
- [x] Task 6 (AC: 6): Configure ESLint and Prettier
  - [x] Configure ESLint + Prettier with strict rules; no console.log in prod. [Source: docs/architecture/coding-standards.md §1]
- [x] Task 7 (AC: 7): Environment variables
  - [x] Create `.env.example` with placeholders (e.g. `DATABASE_URL`, `NEXT_PUBLIC_SUPABASE_URL`, `NEXT_PUBLIC_SUPABASE_ANON_KEY`). [Source: docs/architecture.md §6]
  - [x] Document in README that `.env.local` is a copy of `.env.example` and must not be committed. [Source: docs/architecture/source-tree.md]
- [x] Task 8 (AC: 8, 9): Vercel deployment and health check
  - [x] Add route `src/app/api/health/route.ts` (GET returns 200 OK). [Source: docs/architecture.md §6]
  - [x] Ensure project builds on Vercel (next build succeeds; add vercel.json or rely on defaults). [Source: docs/architecture.md §1.1]
- [x] Task 9 (AC: 8): CI workflow
  - [x] Add `.github/workflows/ci.yml` for lint and typecheck (tests optional for this story). [Source: docs/architecture.md §6, docs/architecture.md §14]
- [x] Task 10 – Testing (AC: 1–9): Verify setup
  - [x] Unit test or smoke test that health route returns 200 (e.g. Vitest + fetch or simple script). [Source: docs/architecture.md §14, docs/architecture/coding-standards.md §6]
  - [x] Run `npm run build` and fix any type/lint errors.

## Dev Notes

### Previous Story Insights

No previous story; this is the first story of Epic 1.

### Data Models

No application data models in this story. Prisma schema will be minimal (e.g. empty or a single placeholder model) until Story 1.2. [Source: docs/architecture.md §5, §6]

### API Specifications

- **Health check:** GET `/api/health` must return HTTP 200 OK. No body contract specified. [Source: docs/architecture.md §6]
- **tRPC:** Handler mounted at `src/app/api/trpc/[...trpc]/`; full procedures and context (auth, companyId) come in Story 1.2. [Source: docs/architecture.md §6, §7.2]

### Component Specifications

- shadcn/ui components go in `src/components/ui/`; do not modify generated code without reason. [Source: docs/architecture/coding-standards.md §4, docs/architecture/source-tree.md §2]
- No business components required for this story; layout/components come in later stories.

### File Locations

| Purpose | Path |
|--------|------|
| App Router root | `src/app/layout.tsx`, `src/app/page.tsx` |
| API health | `src/app/api/health/route.ts` |
| tRPC handler | `src/app/api/trpc/[...trpc]/route.ts` |
| tRPC server | `src/server/trpc/` (trpc.ts, context.ts, routers/_app.ts, index.ts) |
| Prisma | `prisma/schema.prisma`, `prisma/migrations/` |
| Supabase clients | `src/lib/supabase/client.ts`, `src/lib/supabase/server.ts` |
| UI components | `src/components/ui/` |
| CI | `.github/workflows/ci.yml` |

[Source: docs/architecture.md §6, docs/architecture/source-tree.md]

### Technical Constraints

- **TypeScript:** strict mode; prefer arrow functions; no untyped `any`. [Source: docs/architecture/coding-standards.md §1]
- **Stack versions:** Next.js 16.1.6, React 19.2, TypeScript 5.9, Prisma 7.4.0, tRPC 11.0, Tailwind 4.1, Vitest 2.1. [Source: docs/architecture/tech-stack.md]
- **Monorepo:** Single Next.js package; no Turborepo/Nx. [Source: docs/architecture.md §6]
- **Env:** `.env.local` ignored by Git; `.env.example` committed as template. [Source: docs/architecture.md §6]

### Testing

- **Unit/integration:** Vitest. For this story, focus on health route (and optionally lint/typecheck in CI). [Source: docs/architecture.md §14, docs/architecture/coding-standards.md §6]
- **Test location:** `tests/unit/` or `tests/integration/`; E2E in `tests/e2e/` (optional here). [Source: docs/architecture.md §14, docs/architecture/source-tree.md]
- **CI:** Lint + typecheck on every push; tests optional for Story 1.1. [Source: docs/architecture.md §14]

### Project Structure Notes

Structure follows `docs/architecture.md` §6 and `docs/architecture/source-tree.md`. No conflicts identified; this story establishes the skeleton (app/, server/, lib/, prisma/, tests/).

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-14 | 0.1 | Story draft created (1.1 Project Setup & Infrastructure) | Bob (SM) |
| 2026-02-14 | 0.2 | Story implemented: Next.js 16, Prisma 7, tRPC, Supabase, Tailwind, shadcn, ESLint/Prettier, health route, CI, Vitest test | James (Dev) |

---

## Dev Agent Record

*(To be filled by the development agent during implementation.)*

### Agent Model Used

James (dev agent). Model: as per Cursor session.

### Debug Log References

None.

### Completion Notes List

- Next.js 16.1.6, React 19.2, TypeScript 5.9 with strict mode; Git init and .gitignore updated.
- Prisma 7.4.0: datasource URL moved to `prisma.config.ts` (Prisma 7 breaking change); dotenv loads `.env.local`.
- tRPC v11: fetch adapter at `/api/trpc/[...trpc]`; skeleton context and app router (auth/companyId in Story 1.2).
- Supabase: `@supabase/ssr` with createBrowserClient and createServerClient.
- Tailwind 4 + shadcn/ui init; one base component (button) in `src/components/ui/`.
- ESLint 9 flat config (next/core-web-vitals + typescript + prettier), no-console warn, Prettier configured.
- Health route: GET `/api/health` returns 200. Vitest test in `tests/unit/api/health.test.ts`.
- CI: `.github/workflows/ci.yml` runs lint, tsc --noEmit, and build. All validations pass.

### File List

**Created:** package.json, tsconfig.json, next-env.d.ts, next.config.ts, postcss.config.mjs, prisma.config.ts, eslint.config.mjs, .prettierrc, .prettierignore, vitest.config.ts, src/app/layout.tsx, src/app/page.tsx, src/app/api/health/route.ts, src/app/api/trpc/[...trpc]/route.ts, src/server/trpc/trpc.ts, src/server/trpc/context.ts, src/server/trpc/index.ts, src/server/trpc/routers/_app.ts, src/lib/supabase/client.ts, src/lib/supabase/server.ts, src/styles/globals.css, src/components/ui/button.tsx, src/lib/utils.ts, components.json, tests/unit/api/health.test.ts, .github/workflows/ci.yml.

**Modified:** .gitignore, prisma/schema.prisma (removed url from datasource), README.md (env doc), docs/stories/1.1.project-setup-infrastructure.md.

**Pre-existing (unchanged content, used as-is):** .env.example, prisma/schema.prisma (full schema), src/lib/rate-limit.ts.

---

## QA Results

*(Results from QA Agent review of the completed story implementation.)*
